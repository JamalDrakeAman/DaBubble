<section class="box-border pb-4 bg-white">
    <div class="box-border flex flex-col" [ngClass]="{ 'pb-[0]': chatType !== 'dm'}">
        @for (message of messages; track message; let i = $index) {
            @if (newDay) {
                <div class="flex items-center text-[18px] my-[10px] px-4">
                    <div class="w-full h-[1px] bg-lightpurple"></div>
                    <div class="border-lightpurple border-[1px] rounded-full py-[5px] px-[15px]">
                        <p>Heute</p>
                    </div>
                    <div class="w-full h-[1px] bg-lightpurple"></div>
                </div>
            }
            <div id="{{ chatType }}{{ i }}" (click)="mainNavService.editMessage(i, chatType)"
                class="flex gap-5 mt-[25px] px-4 py-2 cursor-pointer hover:bg-primary"
                [ngClass]="{ 'flex-row-reverse': fromCurrentUser('user.id'),  '[&>div>#msg-content]:hover:bg-white': !fromCurrentUser('user.id')}">
                <div class="w-max">
                    <img class="min-w-[50px] size-[50px] rounded-full" src="assets/imgs/avatar{{ 0 }}.svg" alt="Avatar">
                </div>
                <div class="flex flex-col gap-2">
                    <div class="flex items-center gap-5" [ngClass]="{ 'justify-end': fromCurrentUser('user.id')}">
                        <span class="text-lg font-bold">{{ message.sender }}</span>
                        <span class="text-sm">{{ message.timestamp }}</span>
                    </div>
                    <div id="msg-content" class="bg-primary p-[15px] rounded-[30px] w-min"
                        [ngClass]="{ 'bg-purple2 text-white rounded-se-none rounded-ss-[30px]': fromCurrentUser('user.id'), ' rounded-ss-none': !fromCurrentUser('user.id') }">
                        <span>{{ message.message }}</span>
                    </div>

                    <Button (click)="test()">TEST</Button>

                    @if (dummyThreatService.messages) {
                        @if (chatType !== 'thread' && dummyThreatService.messages.length > 0) {
                            <div class="cursor-pointer flex flex-col xs:flex-row xs:items-center xs:gap-[20px]"
                                [ngClass]="{'self-end': fromCurrentUser('user.id')}">
                                <span (click)="mainNavService.openThread()" class="text-base text-purple3 hover:font-bold">{{
                                    dummyThreatService.messages.length }} Antworten</span>
                                <span class="text-sm text-textgray">Letzte Antwort {{
                                    dummyThreatService.messages[dummyThreatService.messages.length - 1].timestamp }}</span>
                            </div>
                        }
                    }

                    @if (message.reactions.length > 0) {
                        <div class="flex items-center gap-2 w-max"
                            [ngClass]="{'self-end pr-[5px]': fromCurrentUser('user.id')}">
                            @for (reaction of message.reactions; track $index) {
                                <button
                                    class="flex items-center border-lightpurple border-[1px] rounded-full gap-[10px] py-[5px] px-[10px]">
                                    <img class="size-6" src="assets/icons/edit.svg" alt="Emoji"><span class="text-base">{{
                                        reaction.users.length }}</span>
                                </button>
                            }
                            <button>
                                <img src="assets/icons/add_emoji.svg" alt="Add emoji">
                            </button>
                        </div>
                    }
                </div>
            </div>
        }
    </div>

</section>